<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="HelpMapper">

<resultMap type="edu.nojo.vote.help.model.dto.QNA3" id="QNA3_rm">
	<result property="qnaContent" column="QNA_CONT" jdbcType="CLOB" javaType="String" />
	<result property="qnaNo" column="QNA_NO" />
	<result property="userNo" column="USER_NO" />
	<result property="qnaCatCode" column="QNA_CAT_CODE" />
	<result property="qnaStatus" column="QNA_STATUS" />
	<result property="qnaTitle" column="QNA_TITLE" />
    <result property="qnaCreateDt" column="QNA_CREATE_DT" />
    <result property="qnaanswer" column="QNA_ANSWER" />
    <result property="qnacompleteddt" column="QNA_COMPLETED_DT" />
    <result property="qnaDelFL" column="QNA_DEL_FL" />
</resultMap>

	<!-- 삭제되지 않은 문의 수 조회 -->
	<select id="QA3" resultType="_int">
		SELECT COUNT(*) FROM "QNA" 
		WHERE QNA_DEL_FL = 'N'
	</select>
	
	<!-- 문의글 조회 -->
	<select id="QNA3" resultMap="QNA3_rm">
		SELECT QNA_NO, QNA_CAT_CODE, QNA_TITLE, QNA_STATUS,
		<![CDATA[ 
		CASE
		WHEN SYSDATE - QNA_CREATE_DT < 1 / 24 / 60
		THEN FLOOR( (SYSDATE -
		QNA_CREATE_DT) * 24 * 60 * 60 ) || '초 전'
		WHEN SYSDATE - QNA_CREATE_DT < 1 / 24
		THEN FLOOR( (SYSDATE - QNA_CREATE_DT)
		* 24 * 60) || '분 전'
		WHEN SYSDATE - QNA_CREATE_DT < 1
		THEN FLOOR( (SYSDATE - QNA_CREATE_DT) *
		24) || '시간 전'
		ELSE TO_CHAR(QNA_CREATE_DT, 'YYYY-MM-DD')
		END QNA_CREATE_DT
		]]>
		FROM "QNA" Q
		JOIN "USER" USING(USER_NO)
		WHERE QNA_DEL_FL = 'N'
		ORDER BY QNA_NO DESC
	</select>
	
	<!-- 문의 글 삽입 -->
	<insert id="helpInsert" parameterType="User" useGeneratedKeys="true">
	
	    <selectKey order="BEFORE" resultType="_int" keyProperty="qnaNo">
	        SELECT SEQ_QNA_NO.NEXTVAL FROM DUAL
	    </selectKey>
	
		INSERT INTO BOARD
		VALUES( #{qnaNo}, DEFAULT
        #{qnaCatCode}, #{qnaStatus}, {qnaTitle}, DEFAULT, 
        #{qnaCreateDt}, DEFAULT, DEFAULT, DEFAULT)
		
	</insert>
</mapper>

